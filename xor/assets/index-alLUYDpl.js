var mt=Object.defineProperty;var bt=(s,e,t)=>e in s?mt(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var M=(s,e,t)=>(bt(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function R(){}const Xe=s=>s;function Ze(s){return s()}function Ae(){return Object.create(null)}function U(s){s.forEach(Ze)}function Ce(s){return typeof s=="function"}function he(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}function gt(s){return Object.keys(s).length===0}function et(s,...e){if(s==null){for(const n of e)n(void 0);return R}const t=s.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function yt(s,e,t){s.$$.on_destroy.push(et(e,t))}const tt=typeof window<"u";let ge=tt?()=>window.performance.now():()=>Date.now(),ve=tt?s=>requestAnimationFrame(s):R;const G=new Set;function nt(s){G.forEach(e=>{e.c(s)||(G.delete(e),e.f())}),G.size!==0&&ve(nt)}function st(s){let e;return G.size===0&&ve(nt),{promise:new Promise(t=>{G.add(e={c:s,f:t})}),abort(){G.delete(e)}}}const it=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;class ne{constructor(e){M(this,"_listeners","WeakMap"in it?new WeakMap:void 0);M(this,"_observer");M(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{var t;for(const n of e)ne.entries.set(n.target,n),(t=this._listeners.get(n.target))==null||t(n)}))}}ne.entries="WeakMap"in it?new WeakMap:void 0;function Z(s,e){s.appendChild(e)}function ot(s){if(!s)return document;const e=s.getRootNode?s.getRootNode():s.ownerDocument;return e&&e.host?e:s.ownerDocument}function wt(s){const e=ee("style");return e.textContent="/* empty */",St(ot(s),e),e.sheet}function St(s,e){return Z(s.head||s,e),e.sheet}function j(s,e,t){s.insertBefore(e,t||null)}function A(s){s.parentNode&&s.parentNode.removeChild(s)}function rt(s,e){for(let t=0;t<s.length;t+=1)s[t]&&s[t].d(e)}function ee(s){return document.createElement(s)}function oe(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function at(s){return document.createTextNode(s)}function qe(){return at(" ")}function ke(){return at("")}function z(s,e,t,n){return s.addEventListener(e,t,n),()=>s.removeEventListener(e,t,n)}function xe(s){return function(e){return e.preventDefault(),s.call(this,e)}}function v(s,e,t){t==null?s.removeAttribute(e):s.getAttribute(e)!==t&&s.setAttribute(e,t)}function _t(s){return Array.from(s.childNodes)}function W(s,e,t,n){t==null?s.style.removeProperty(e):s.style.setProperty(e,t,n?"important":"")}const Ct=new ne({box:"border-box"});function vt(s,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(s,{detail:e,bubbles:t,cancelable:n})}const re=new Map;let ae=0;function kt(s){let e=5381,t=s.length;for(;t--;)e=(e<<5)-e^s.charCodeAt(t);return e>>>0}function Ot(s,e){const t={stylesheet:wt(e),rules:{}};return re.set(s,t),t}function je(s,e,t,n,i,o,r,a=0){const h=16.666/n;let c=`{
`;for(let m=0;m<=1;m+=h){const b=e+(t-e)*o(m);c+=m*100+`%{${r(b,1-b)}}
`}const S=c+`100% {${r(t,1-t)}}
}`,p=`__svelte_${kt(S)}_${a}`,C=ot(s),{stylesheet:_,rules:d}=re.get(C)||Ot(C,s);d[p]||(d[p]=!0,_.insertRule(`@keyframes ${p} ${S}`,_.cssRules.length));const u=s.style.animation||"";return s.style.animation=`${u?`${u}, `:""}${p} ${n}ms linear ${i}ms 1 both`,ae+=1,p}function Pt(s,e){const t=(s.style.animation||"").split(", "),n=t.filter(e?o=>o.indexOf(e)<0:o=>o.indexOf("__svelte")===-1),i=t.length-n.length;i&&(s.style.animation=n.join(", "),ae-=i,ae||Tt())}function Tt(){ve(()=>{ae||(re.forEach(s=>{const{ownerNode:e}=s.stylesheet;e&&A(e)}),re.clear())})}let te;function X(s){te=s}function Et(){if(!te)throw new Error("Function called outside component initialization");return te}function Oe(s){Et().$$.on_mount.push(s)}const K=[],Le=[];let H=[];const $e=[],It=Promise.resolve();let ye=!1;function Rt(){ye||(ye=!0,It.then(ct))}function V(s){H.push(s)}const pe=new Set;let D=0;function ct(){if(D!==0)return;const s=te;do{try{for(;D<K.length;){const e=K[D];D++,X(e),At(e.$$)}}catch(e){throw K.length=0,D=0,e}for(X(null),K.length=0,D=0;Le.length;)Le.pop()();for(let e=0;e<H.length;e+=1){const t=H[e];pe.has(t)||(pe.add(t),t())}H.length=0}while(K.length);for(;$e.length;)$e.pop()();ye=!1,pe.clear(),X(s)}function At(s){if(s.fragment!==null){s.update(),U(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(V)}}function qt(s){const e=[],t=[];H.forEach(n=>s.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),H=e}let Y;function xt(){return Y||(Y=Promise.resolve(),Y.then(()=>{Y=null})),Y}function me(s,e,t){s.dispatchEvent(vt(`${e?"intro":"outro"}${t}`))}const ie=new Set;let x;function we(){x={r:0,c:[],p:x}}function Se(){x.r||U(x.c),x=x.p}function q(s,e){s&&s.i&&(ie.delete(s),s.i(e))}function $(s,e,t,n){if(s&&s.o){if(ie.has(s))return;ie.add(s),x.c.push(()=>{ie.delete(s),n&&(t&&s.d(1),n())}),s.o(e)}else n&&n()}const jt={duration:0};function ce(s,e,t,n){let o=e(s,t,{direction:"both"}),r=n?0:1,a=null,h=null,c=null,S;function p(){c&&Pt(s,c)}function C(d,u){const m=d.b-r;return u*=Math.abs(m),{a:r,b:d.b,d:m,duration:u,start:d.start,end:d.start+u,group:d.group}}function _(d){const{delay:u=0,duration:m=300,easing:b=Xe,tick:w=R,css:l}=o||jt,f={start:ge()+u,b:d};d||(f.group=x,x.r+=1),"inert"in s&&(d?S!==void 0&&(s.inert=S):(S=s.inert,s.inert=!0)),a||h?h=f:(l&&(p(),c=je(s,r,d,m,u,b,l)),d&&w(0,1),a=C(f,m),V(()=>me(s,d,"start")),st(g=>{if(h&&g>h.start&&(a=C(h,m),h=null,me(s,a.b,"start"),l&&(p(),c=je(s,r,a.b,a.duration,0,b,o.css))),a){if(g>=a.end)w(r=a.b,1-r),me(s,a.b,"end"),h||(a.b?p():--a.group.r||U(a.group.c)),a=null;else if(g>=a.start){const P=g-a.start;r=a.a+a.d*b(P/a.duration),w(r,1-r)}}return!!(a||h)}))}return{run(d){Ce(o)?xt().then(()=>{o=o({direction:d?"in":"out"}),_(d)}):_(d)},end(){p(),a=h=null}}}function L(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function Ue(s,e){$(s,1,1,()=>{e.delete(s.key)})}function Ne(s,e,t,n,i,o,r,a,h,c,S,p){let C=s.length,_=o.length,d=C;const u={};for(;d--;)u[s[d].key]=d;const m=[],b=new Map,w=new Map,l=[];for(d=_;d--;){const k=p(i,o,d),T=t(k);let y=r.get(T);y?n&&l.push(()=>y.p(k,e)):(y=c(T,k),y.c()),b.set(T,m[d]=y),T in u&&w.set(T,Math.abs(d-u[T]))}const f=new Set,g=new Set;function P(k){q(k,1),k.m(a,S),r.set(k.key,k),S=k.first,_--}for(;C&&_;){const k=m[_-1],T=s[C-1],y=k.key,O=T.key;k===T?(S=k.first,C--,_--):b.has(O)?!r.has(y)||f.has(y)?P(k):g.has(O)?C--:w.get(y)>w.get(O)?(g.add(y),P(k)):(f.add(O),C--):(h(T,r),C--)}for(;C--;){const k=s[C];b.has(k.key)||h(k,r)}for(;_;)P(m[_-1]);return U(l),m}function Pe(s){s&&s.c()}function ue(s,e,t){const{fragment:n,after_update:i}=s.$$;n&&n.m(e,t),V(()=>{const o=s.$$.on_mount.map(Ze).filter(Ce);s.$$.on_destroy?s.$$.on_destroy.push(...o):U(o),s.$$.on_mount=[]}),i.forEach(V)}function de(s,e){const t=s.$$;t.fragment!==null&&(qt(t.after_update),U(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Lt(s,e){s.$$.dirty[0]===-1&&(K.push(s),Rt(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function Te(s,e,t,n,i,o,r=null,a=[-1]){const h=te;X(s);const c=s.$$={fragment:null,ctx:[],props:o,update:R,not_equal:i,bound:Ae(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:Ae(),dirty:a,skip_bound:!1,root:e.target||h.$$.root};r&&r(c.root);let S=!1;if(c.ctx=t?t(s,e.props||{},(p,C,..._)=>{const d=_.length?_[0]:C;return c.ctx&&i(c.ctx[p],c.ctx[p]=d)&&(!c.skip_bound&&c.bound[p]&&c.bound[p](d),S&&Lt(s,p)),C}):[],c.update(),S=!0,U(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const p=_t(e.target);c.fragment&&c.fragment.l(p),p.forEach(A)}else c.fragment&&c.fragment.c();e.intro&&q(s.$$.fragment),ue(s,e.target,e.anchor),ct()}X(h)}class Ee{constructor(){M(this,"$$");M(this,"$$set")}$destroy(){de(this,1),this.$destroy=R}$on(e,t){if(!Ce(t))return R;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!gt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const $t="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($t);const B=[];function lt(s,e=R){let t;const n=new Set;function i(a){if(he(s,a)&&(s=a,t)){const h=!B.length;for(const c of n)c[1](),B.push(c,s);if(h){for(let c=0;c<B.length;c+=2)B[c][0](B[c+1]);B.length=0}}}function o(a){i(a(s))}function r(a,h=R){const c=[a,h];return n.add(c),n.size===1&&(t=e(i,o)||R),a(s),()=>{n.delete(c),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:r}}function Fe(s){return Object.prototype.toString.call(s)==="[object Date]"}function _e(s,e,t,n){if(typeof t=="number"||Fe(t)){const i=n-t,o=(t-e)/(s.dt||1/60),r=s.opts.stiffness*i,a=s.opts.damping*o,h=(r-a)*s.inv_mass,c=(o+h)*s.dt;return Math.abs(c)<s.opts.precision&&Math.abs(i)<s.opts.precision?n:(s.settled=!1,Fe(t)?new Date(t.getTime()+c):t+c)}else{if(Array.isArray(t))return t.map((i,o)=>_e(s,e[o],t[o],n[o]));if(typeof t=="object"){const i={};for(const o in t)i[o]=_e(s,e[o],t[o],n[o]);return i}else throw new Error(`Cannot spring ${typeof t} values`)}}function Ut(s,e={}){const t=lt(s),{stiffness:n=.15,damping:i=.8,precision:o=.01}=e;let r,a,h,c=s,S=s,p=1,C=0,_=!1;function d(m,b={}){S=m;const w=h={};return s==null||b.hard||u.stiffness>=1&&u.damping>=1?(_=!0,r=ge(),c=m,t.set(s=S),Promise.resolve()):(b.soft&&(C=1/((b.soft===!0?.5:+b.soft)*60),p=0),a||(r=ge(),_=!1,a=st(l=>{if(_)return _=!1,a=null,!1;p=Math.min(p+C,1);const f={inv_mass:p,opts:u,settled:!0,dt:(l-r)*60/1e3},g=_e(f,c,s,S);return r=l,c=s,t.set(s=g),f.settled&&(a=null),!f.settled})),new Promise(l=>{a.promise.then(()=>{w===h&&l()})}))}const u={set:d,update:(m,b)=>d(m(S,s),b),subscribe:t.subscribe,stiffness:n,damping:i,precision:o};return u}function le(s,{delay:e=0,duration:t=400,easing:n=Xe}={}){const i=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:n,css:o=>`opacity: ${o*i}`}}const Nt={square:{origin:{x:1,y:1},path:[{x:0,y:0},{x:2,y:0},{x:2,y:2},{x:0,y:2}]},triangle:{origin:{x:1,y:1},path:[{x:0,y:0},{x:2,y:0},{x:0,y:2}]}};function Ft(s){let e,t,n,i,o,r,a,h,c;return{c(){e=ee("div"),t=oe("svg"),n=oe("path"),v(n,"d",i=s[6](s[0].path)),v(n,"class","svelte-7o3efv"),v(t,"width","100%"),v(t,"height","100%"),v(t,"viewBox",o=s[7](s[0].origin)),v(t,"preserveAspectRatio","none"),v(t,"fill","currentColor"),v(t,"class","svelte-7o3efv"),v(e,"role","cell"),v(e,"tabindex","-1"),v(e,"class","svelte-7o3efv"),W(e,"--y",`${s[1].y}%`),W(e,"--x",`${s[1].x}%`)},m(S,p){j(S,e,p),Z(e,t),Z(t,n),a=!0,h||(c=[z(window,"mousemove",s[3]),z(window,"touchmove",s[3]),z(window,"mouseup",s[5]),z(window,"touchend",s[5]),z(e,"mousedown",xe(s[4])),z(e,"touchstart",xe(s[4]))],h=!0)},p(S,[p]){s=S,(!a||p&1&&i!==(i=s[6](s[0].path)))&&v(n,"d",i),(!a||p&1&&o!==(o=s[7](s[0].origin)))&&v(t,"viewBox",o),p&2&&W(e,"--y",`${s[1].y}%`),p&2&&W(e,"--x",`${s[1].x}%`)},i(S){a||(V(()=>{a&&(r||(r=ce(e,le,{duration:100,delay:s[8]},!0)),r.run(1))}),a=!0)},o(S){r||(r=ce(e,le,{duration:100,delay:s[8]},!1)),r.run(0),a=!1},d(S){S&&A(e),S&&r&&r.end(),h=!1,U(c)}}}function Mt(s,e,t){let n,{id:i}=e,{shapeSkin:o}=e,{boardPoints:r=[]}=e,{boardSize:a}=e,{blockSize:h=1}=e,c=!1,S={x:0,y:0},{shapePos:p={x:0,y:0}}=e,{shape:C}=e;const _=y=>y/h,d=()=>Math.random()*100,u=Ut({x:d(),y:d()},{stiffness:.1,damping:.25});yt(s,u,y=>t(1,n=y));const m=y=>{let O=y.touches?y.touches[0]:y;return{x:O.clientX,y:O.clientY}},b=y=>{if(!c)return;const O=m(y);c&&u.set({x:_(O.x)*100-S.x,y:_(O.y)*100-S.y})},w=y=>{c=!0;const O=m(y),N=y.touches?30:0;S={x:_(O.x)*100-n.x,y:_(O.y+N)*100-n.y}},l=(y,O)=>r.flat().reduce((Q,fe)=>{const Re=Math.sqrt((fe.x-y)**2+(fe.y-O)**2);return Re<Q.distance?{distance:Re,point:fe}:Q},{distance:1/0,point:{x:0,y:0}}).point,f=(y,O=!1)=>{const{x:N,y:Q}=l(y.x,y.y);u.set({x:N/a*100,y:Q/a*100}),O&&C.setPos({x:N+.5,y:Q+.5})},g=()=>{c&&(c=!1,f({x:n.x/100*a,y:n.y/100*a},!0))},P=y=>y.map((O,N)=>`${N===0?"M":"L"} ${O.x} ${O.y}`).join(" ")+" Z",k=(y,O={x:1,y:1})=>`${y.x} ${y.y} ${O.x} ${O.y}`;let T=100*i+500;return Oe(()=>{setTimeout(()=>{f(p)},T)}),s.$$set=y=>{"id"in y&&t(9,i=y.id),"shapeSkin"in y&&t(0,o=y.shapeSkin),"boardPoints"in y&&t(10,r=y.boardPoints),"boardSize"in y&&t(11,a=y.boardSize),"blockSize"in y&&t(12,h=y.blockSize),"shapePos"in y&&t(13,p=y.shapePos),"shape"in y&&t(14,C=y.shape)},[o,n,u,b,w,g,P,k,T,i,r,a,h,p,C]}class ht extends Ee{constructor(e){super(),Te(this,e,Mt,Ft,he,{id:9,shapeSkin:0,boardPoints:10,boardSize:11,blockSize:12,shapePos:13,shape:14})}}class I extends Error{constructor(e){var t,n,i,o;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,I.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof I||(this.originalError=e),typeof DOMException<"u"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(o=(i=(n=this.originalError)==null?void 0:n.cause)==null?void 0:i.message)!=null&&o.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}}const se=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function zt(s,e){const t={};if(typeof s!="string")return t;const n=Object.assign({},e||{}).decode||Dt;let i=0;for(;i<s.length;){const o=s.indexOf("=",i);if(o===-1)break;let r=s.indexOf(";",i);if(r===-1)r=s.length;else if(r<o){i=s.lastIndexOf(";",o-1)+1;continue}const a=s.slice(i,o).trim();if(t[a]===void 0){let h=s.slice(o+1,r).trim();h.charCodeAt(0)===34&&(h=h.slice(1,-1));try{t[a]=n(h)}catch{t[a]=h}}i=r+1}return t}function Me(s,e,t){const n=Object.assign({},t||{}),i=n.encode||Bt;if(!se.test(s))throw new TypeError("argument name is invalid");const o=i(e);if(o&&!se.test(o))throw new TypeError("argument val is invalid");let r=s+"="+o;if(n.maxAge!=null){const a=n.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");r+="; Max-Age="+Math.floor(a)}if(n.domain){if(!se.test(n.domain))throw new TypeError("option domain is invalid");r+="; Domain="+n.domain}if(n.path){if(!se.test(n.path))throw new TypeError("option path is invalid");r+="; Path="+n.path}if(n.expires){if(!function(h){return Object.prototype.toString.call(h)==="[object Date]"||h instanceof Date}(n.expires)||isNaN(n.expires.valueOf()))throw new TypeError("option expires is invalid");r+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(r+="; HttpOnly"),n.secure&&(r+="; Secure"),n.priority)switch(typeof n.priority=="string"?n.priority.toLowerCase():n.priority){case"low":r+="; Priority=Low";break;case"medium":r+="; Priority=Medium";break;case"high":r+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r}function Dt(s){return s.indexOf("%")!==-1?decodeURIComponent(s):s}function Bt(s){return encodeURIComponent(s)}let ut;function J(s){if(s)try{const e=decodeURIComponent(ut(s.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch{}return{}}function dt(s,e=0){let t=J(s);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}ut=typeof atob=="function"?atob:s=>{let e=String(s).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,n,i=0,o=0,r="";n=e.charAt(o++);~n&&(t=i%4?64*t+n:n,i++%4)?r+=String.fromCharCode(255&t>>(-2*i&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return r};const ze="pb_auth";class Kt{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!dt(this.token)}get isAdmin(){return J(this.token).type==="admin"}get isAuthRecord(){return J(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=ze){const n=zt(e||"")[t]||"";let i={};try{i=JSON.parse(n),(typeof i===null||typeof i!="object"||Array.isArray(i))&&(i={})}catch{}this.save(i.token||"",i.model||null)}exportToCookie(e,t=ze){var h,c;const n={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},i=J(this.token);n.expires=i!=null&&i.exp?new Date(1e3*i.exp):new Date("1970-01-01"),e=Object.assign({},n,e);const o={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null};let r=Me(t,JSON.stringify(o),e);const a=typeof Blob<"u"?new Blob([r]).size:r.length;if(o.model&&a>4096){o.model={id:(h=o==null?void 0:o.model)==null?void 0:h.id,email:(c=o==null?void 0:o.model)==null?void 0:c.email};const S=["collectionId","username","verified"];for(const p in this.model)S.includes(p)&&(o.model[p]=this.model[p]);r=Me(t,JSON.stringify(o),e)}return r}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let n=this._onChangeCallbacks.length-1;n>=0;n--)if(this._onChangeCallbacks[n]==e)return delete this._onChangeCallbacks[n],void this._onChangeCallbacks.splice(n,1)}}triggerChange(){for(const e of this._onChangeCallbacks)e&&e(this.token,this.model)}}class Wt extends Kt{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window<"u"&&(window!=null&&window.localStorage)){const t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch{return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window<"u"&&(window!=null&&window.localStorage)){let n=t;typeof t!="string"&&(n=JSON.stringify(t)),window.localStorage.setItem(e,n)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window<"u"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window<"u"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;const t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}}class F{constructor(e){this.client=e}}class Gt extends F{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,n){return n=Object.assign({method:"POST",body:{email:e,template:t}},n),this.client.send("/api/settings/test/email",n).then(()=>!0)}async generateAppleClientSecret(e,t,n,i,o,r){return r=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:n,privateKey:i,duration:o}},r),this.client.send("/api/settings/apple/generate-client-secret",r)}}class Ie extends F{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let n=500;return(t=Object.assign({},e,t)).batch&&(n=t.batch,delete t.batch),this._getFullList(n,t)}async getList(e=1,t=30,n){return(n=Object.assign({method:"GET"},n)).query=Object.assign({page:e,perPage:t},n.query),this.client.send(this.baseCrudPath,n).then(i=>{var o;return i.items=((o=i.items)==null?void 0:o.map(r=>this.decode(r)))||[],i})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(n=>{var i;if(!((i=n==null?void 0:n.items)!=null&&i.length))throw new I({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return n.items[0]})}async getOne(e,t){if(!e)throw new I({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(n=>this.decode(n))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(n=>this.decode(n))}async update(e,t,n){return n=Object.assign({method:"PATCH",body:t},n),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),n).then(i=>this.decode(i))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let n=[],i=async o=>this.getList(o,e||500,t).then(r=>{const a=r.items;return n=n.concat(a),a.length==r.perPage?i(o+1):n});return i(1)}}function E(s,e,t,n){const i=n!==void 0;return i||t!==void 0?i?(console.warn(s),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,n),e):Object.assign(e,t):e}function be(s){var e;(e=s._resetAutoRefresh)==null||e.call(s)}class Ht extends Ie{get baseCrudPath(){return"/api/admins"}async update(e,t,n){return super.update(e,t,n).then(i=>{var o,r;return((o=this.client.authStore.model)==null?void 0:o.id)===i.id&&((r=this.client.authStore.model)==null?void 0:r.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,i),i})}async delete(e,t){return super.delete(e,t).then(n=>{var i,o;return n&&((i=this.client.authStore.model)==null?void 0:i.id)===e&&((o=this.client.authStore.model)==null?void 0:o.collectionId)===void 0&&this.client.authStore.clear(),n})}authResponse(e){const t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,n,i){let o={method:"POST",body:{identity:e,password:t}};o=E("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",o,n,i);const r=o.autoRefreshThreshold;delete o.autoRefreshThreshold,o.autoRefresh||be(this.client);let a=await this.client.send(this.baseCrudPath+"/auth-with-password",o);return a=this.authResponse(a),r&&function(c,S,p,C){be(c);const _=c.beforeSend,d=c.authStore.model,u=c.authStore.onChange((m,b)=>{(!m||(b==null?void 0:b.id)!=(d==null?void 0:d.id)||(b!=null&&b.collectionId||d!=null&&d.collectionId)&&(b==null?void 0:b.collectionId)!=(d==null?void 0:d.collectionId))&&be(c)});c._resetAutoRefresh=function(){u(),c.beforeSend=_,delete c._resetAutoRefresh},c.beforeSend=async(m,b)=>{var g;const w=c.authStore.token;if((g=b.query)!=null&&g.autoRefresh)return _?_(m,b):{url:m,sendOptions:b};let l=c.authStore.isValid;if(l&&dt(c.authStore.token,S))try{await p()}catch{l=!1}l||await C();const f=b.headers||{};for(let P in f)if(P.toLowerCase()=="authorization"&&w==f[P]&&c.authStore.token){f[P]=c.authStore.token;break}return b.headers=f,_?_(m,b):{url:m,sendOptions:b}}}(this.client,r,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},o))),a}async authRefresh(e,t){let n={method:"POST"};return n=E("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",n,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",n).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,n){let i={method:"POST",body:{email:e}};return i=E("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",i,t,n),this.client.send(this.baseCrudPath+"/request-password-reset",i).then(()=>!0)}async confirmPasswordReset(e,t,n,i,o){let r={method:"POST",body:{token:e,password:t,passwordConfirm:n}};return r=E("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",r,i,o),this.client.send(this.baseCrudPath+"/confirm-password-reset",r).then(()=>!0)}}const Jt=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function ft(s){if(s){s.query=s.query||{};for(let e in s)Jt.includes(e)||(s.query[e]=s[e],delete s[e])}}class pt extends F{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,n){var r;if(!e)throw new Error("topic must be set.");let i=e;if(n){ft(n);const a="options="+encodeURIComponent(JSON.stringify({query:n.query,headers:n.headers}));i+=(i.includes("?")?"&":"?")+a}const o=function(a){const h=a;let c;try{c=JSON.parse(h==null?void 0:h.data)}catch{}t(c||{})};return this.subscriptions[i]||(this.subscriptions[i]=[]),this.subscriptions[i].push(o),this.isConnected?this.subscriptions[i].length===1?await this.submitSubscriptions():(r=this.eventSource)==null||r.addEventListener(i,o):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,o)}async unsubscribe(e){var n;let t=!1;if(e){const i=this.getSubscriptionsByTopic(e);for(let o in i)if(this.hasSubscriptionListeners(o)){for(let r of this.subscriptions[o])(n=this.eventSource)==null||n.removeEventListener(o,r);delete this.subscriptions[o],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var n;let t=!1;for(let i in this.subscriptions)if((i+"?").startsWith(e)){t=!0;for(let o of this.subscriptions[i])(n=this.eventSource)==null||n.removeEventListener(i,o);delete this.subscriptions[i]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var o;let n=!1;const i=this.getSubscriptionsByTopic(e);for(let r in i){if(!Array.isArray(this.subscriptions[r])||!this.subscriptions[r].length)continue;let a=!1;for(let h=this.subscriptions[r].length-1;h>=0;h--)this.subscriptions[r][h]===t&&(a=!0,delete this.subscriptions[r][h],this.subscriptions[r].splice(h,1),(o=this.eventSource)==null||o.removeEventListener(r,t));a&&(this.subscriptions[r].length||delete this.subscriptions[r],n||this.hasSubscriptionListeners(r)||(n=!0))}this.hasSubscriptionListeners()?n&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,n;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let i in this.subscriptions)if((n=this.subscriptions[i])!=null&&n.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){const t={};e=e.includes("?")?e:e+"?";for(let n in this.subscriptions)(n+"?").startsWith(e)&&(t[n]=this.subscriptions[n]);return t}getNonEmptySubscriptionKeys(){const e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{const t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let n=3;for(;this.hasUnsentSubscriptions()&&n>0;)n--,await this.submitSubscriptions()}).then(()=>{for(let i of this.pendingConnects)i.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);const n=this.getSubscriptionsByTopic("PB_CONNECT");for(let i in n)for(let o of n[i])o(e)}).catch(n=>{this.clientId="",this.connectErrorHandler(n)})})}hasUnsentSubscriptions(){const e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(const t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let n of this.pendingConnects)n.reject(new I(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);const t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[]}}}class Vt extends Ie{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,n){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,n)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);const n=Object.assign({},e,t);return super.getFullList(n)}async getList(e=1,t=30,n){return super.getList(e,t,n)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,n){return super.update(e,t,n).then(i=>{var o,r,a;return((o=this.client.authStore.model)==null?void 0:o.id)!==(i==null?void 0:i.id)||((r=this.client.authStore.model)==null?void 0:r.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,i),i})}async delete(e,t){return super.delete(e,t).then(n=>{var i,o,r;return!n||((i=this.client.authStore.model)==null?void 0:i.id)!==e||((o=this.client.authStore.model)==null?void 0:o.collectionId)!==this.collectionIdOrName&&((r=this.client.authStore.model)==null?void 0:r.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),n})}authResponse(e){const t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,n,i){let o={method:"POST",body:{identity:e,password:t}};return o=E("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",o,n,i),this.client.send(this.baseCollectionPath+"/auth-with-password",o).then(r=>this.authResponse(r))}async authWithOAuth2Code(e,t,n,i,o,r,a){let h={method:"POST",body:{provider:e,code:t,codeVerifier:n,redirectUrl:i,createData:o}};return h=E("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",h,r,a),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",h).then(c=>this.authResponse(c))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});const t=(e==null?void 0:e[0])||{},n=(await this.listAuthMethods()).authProviders.find(h=>h.name===t.provider);if(!n)throw new I(new Error(`Missing or invalid provider "${t.provider}".`));const i=this.client.buildUrl("/api/oauth2-redirect"),o=new pt(this.client);let r=null;function a(){r==null||r.close(),o.unsubscribe()}return t.urlCallback||(r=De(void 0)),new Promise(async(h,c)=>{var S;try{await o.subscribe("@oauth2",async d=>{const u=o.clientId;try{if(!d.state||u!==d.state)throw new Error("State parameters don't match.");if(d.error||!d.code)throw new Error("OAuth2 redirect error or missing code: "+d.error);const m=Object.assign({},t);delete m.provider,delete m.scopes,delete m.createData,delete m.urlCallback;const b=await this.authWithOAuth2Code(n.name,d.code,n.codeVerifier,i,t.createData,m);h(b)}catch(m){c(new I(m))}a()});const p={state:o.clientId};(S=t.scopes)!=null&&S.length&&(p.scope=t.scopes.join(" "));const C=this._replaceQueryParams(n.authUrl+i,p);await(t.urlCallback||function(d){r?r.location.href=d:r=De(d)})(C)}catch(p){a(),c(new I(p))}})}async authRefresh(e,t){let n={method:"POST"};return n=E("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",n,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",n).then(i=>this.authResponse(i))}async requestPasswordReset(e,t,n){let i={method:"POST",body:{email:e}};return i=E("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",i,t,n),this.client.send(this.baseCollectionPath+"/request-password-reset",i).then(()=>!0)}async confirmPasswordReset(e,t,n,i,o){let r={method:"POST",body:{token:e,password:t,passwordConfirm:n}};return r=E("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",r,i,o),this.client.send(this.baseCollectionPath+"/confirm-password-reset",r).then(()=>!0)}async requestVerification(e,t,n){let i={method:"POST",body:{email:e}};return i=E("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",i,t,n),this.client.send(this.baseCollectionPath+"/request-verification",i).then(()=>!0)}async confirmVerification(e,t,n){let i={method:"POST",body:{token:e}};return i=E("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",i,t,n),this.client.send(this.baseCollectionPath+"/confirm-verification",i).then(()=>{const o=J(e),r=this.client.authStore.model;return r&&!r.verified&&r.id===o.id&&r.collectionId===o.collectionId&&(r.verified=!0,this.client.authStore.save(this.client.authStore.token,r)),!0})}async requestEmailChange(e,t,n){let i={method:"POST",body:{newEmail:e}};return i=E("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",i,t,n),this.client.send(this.baseCollectionPath+"/request-email-change",i).then(()=>!0)}async confirmEmailChange(e,t,n,i){let o={method:"POST",body:{token:e,password:t}};return o=E("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",o,n,i),this.client.send(this.baseCollectionPath+"/confirm-email-change",o).then(()=>{const r=J(e),a=this.client.authStore.model;return a&&a.id===r.id&&a.collectionId===r.collectionId&&this.client.authStore.clear(),!0})}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,n){return n=Object.assign({method:"DELETE"},n),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),n).then(()=>!0)}_replaceQueryParams(e,t={}){let n=e,i="";e.indexOf("?")>=0&&(n=e.substring(0,e.indexOf("?")),i=e.substring(e.indexOf("?")+1));const o={},r=i.split("&");for(const a of r){if(a=="")continue;const h=a.split("=");o[decodeURIComponent(h[0].replace(/\+/g," "))]=decodeURIComponent((h[1]||"").replace(/\+/g," "))}for(let a in t)t.hasOwnProperty(a)&&(t[a]==null?delete o[a]:o[a]=t[a]);i="";for(let a in o)o.hasOwnProperty(a)&&(i!=""&&(i+="&"),i+=encodeURIComponent(a.replace(/%20/g,"+"))+"="+encodeURIComponent(o[a].replace(/%20/g,"+")));return i!=""?n+"?"+i:n}}function De(s){if(typeof window>"u"||!(window!=null&&window.open))throw new I(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,n=window.innerWidth,i=window.innerHeight;e=e>n?n:e,t=t>i?i:t;let o=n/2-e/2,r=i/2-t/2;return window.open(s,"popup_window","width="+e+",height="+t+",top="+r+",left="+o+",resizable,menubar=no")}class Qt extends Ie{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,n){return n=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},n),this.client.send(this.baseCrudPath+"/import",n).then(()=>!0)}}class Yt extends F{async getList(e=1,t=30,n){return(n=Object.assign({method:"GET"},n)).query=Object.assign({page:e,perPage:t},n.query),this.client.send("/api/logs",n)}async getOne(e,t){if(!e)throw new I({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}}class Xt extends F{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}}class Zt extends F{getUrl(e,t,n={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";const i=[];i.push("api"),i.push("files"),i.push(encodeURIComponent(e.collectionId||e.collectionName)),i.push(encodeURIComponent(e.id)),i.push(encodeURIComponent(t));let o=this.client.buildUrl(i.join("/"));if(Object.keys(n).length){n.download===!1&&delete n.download;const r=new URLSearchParams(n);o+=(o.includes("?")?"&":"?")+r}return o}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}}class en extends F{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}}class tn{constructor(e="/",t,n="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=n,this.authStore=t||new Wt,this.admins=new Ht(this),this.collections=new Qt(this),this.files=new Zt(this),this.logs=new Yt(this),this.settings=new Gt(this),this.realtime=new pt(this),this.health=new Xt(this),this.backups=new en(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Vt(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let n in t){let i=t[n];switch(typeof i){case"boolean":case"number":i=""+i;break;case"string":i="'"+i.replace(/'/g,"\\'")+"'";break;default:i=i===null?"null":i instanceof Date?"'"+i.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(i).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+n+"}",i)}return e}getFileUrl(e,t,n={}){return this.files.getUrl(e,t,n)}buildUrl(e){var n;let t=this.baseUrl;return typeof window>"u"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(n=window.location.origin)!=null&&n.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let n=this.buildUrl(e);if(this.beforeSend){const i=Object.assign({},await this.beforeSend(n,t));i.url!==void 0||i.options!==void 0?(n=i.url||n,t=i.options||t):Object.keys(i).length&&(t=i,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){const i=this.serializeQueryParams(t.query);i&&(n+=(n.includes("?")?"&":"?")+i),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(n,t).then(async i=>{let o={};try{o=await i.json()}catch{}if(this.afterSend&&(o=await this.afterSend(i,o)),i.status>=400)throw new I({url:i.url,status:i.status,data:o});return o}).catch(i=>{throw new I(i)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),ft(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){const n=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(n);const i=new AbortController;this.cancelControllers[n]=i,t.signal=i.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData>"u"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;const t=new FormData;for(const n in e){const i=e[n];if(typeof i!="object"||this.hasBlobField({data:i})){const o=Array.isArray(i)?i:[i];for(let r of o)t.append(n,r)}else{let o={};o[n]=i,t.append("@jsonPayload",JSON.stringify(o))}}return t}hasBlobField(e){for(const t in e){const n=Array.isArray(e[t])?e[t]:[e[t]];for(const i of n)if(typeof Blob<"u"&&i instanceof Blob||typeof File<"u"&&i instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let n in e)if(n.toLowerCase()==t)return e[n];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData<"u"&&e instanceof FormData)}serializeQueryParams(e){const t=[];for(const n in e){if(e[n]===null)continue;const i=e[n],o=encodeURIComponent(n);if(Array.isArray(i))for(const r of i)t.push(o+"="+encodeURIComponent(r));else i instanceof Date?t.push(o+"="+encodeURIComponent(i.toISOString())):typeof i!==null&&typeof i=="object"?t.push(o+"="+encodeURIComponent(JSON.stringify(i))):t.push(o+"="+encodeURIComponent(i))}return t.join("&")}}function Be(s,e,t){const n=s.slice();return n[9]=e[t],n}function Ke(s,e,t){const n=s.slice();return n[12]=e[t],n}function We(s,e,t){const n=s.slice();return n[15]=e[t],n}function Ge(s,e,t){const n=s.slice();return n[15]=e[t],n}function He(s,e){let t,n,i;return n=new ht({props:{id:e[15].id,shapePos:e[15].pos,boardPoints:e[4].boardPoints,boardSize:e[4].boardSize,blockSize:e[2],shapeSkin:e[15].loadSkin(),shape:e[15]}}),{key:s,first:null,c(){t=ke(),Pe(n.$$.fragment),this.first=t},m(o,r){j(o,t,r),ue(n,o,r),i=!0},p(o,r){e=o;const a={};r&8&&(a.id=e[15].id),r&8&&(a.shapePos=e[15].pos),r&4&&(a.blockSize=e[2]),r&8&&(a.shapeSkin=e[15].loadSkin()),r&8&&(a.shape=e[15]),n.$set(a)},i(o){i||(q(n.$$.fragment,o),i=!0)},o(o){$(n.$$.fragment,o),i=!1},d(o){o&&A(t),de(n,o)}}}function Je(s,e){let t,n,i;return n=new ht({props:{id:e[15].id,shapePos:e[15].pos,boardPoints:e[4].boardPoints,boardSize:e[4].boardSize,blockSize:e[2],shapeSkin:e[15].loadSkin(),shape:e[15]}}),{key:s,first:null,c(){t=ke(),Pe(n.$$.fragment),this.first=t},m(o,r){j(o,t,r),ue(n,o,r),i=!0},p(o,r){e=o;const a={};r&8&&(a.id=e[15].id),r&8&&(a.shapePos=e[15].pos),r&4&&(a.blockSize=e[2]),r&8&&(a.shapeSkin=e[15].loadSkin()),r&8&&(a.shape=e[15]),n.$set(a)},i(o){i||(q(n.$$.fragment,o),i=!0)},o(o){$(n.$$.fragment,o),i=!1},d(o){o&&A(t),de(n,o)}}}function Ve(s){let e;return{c(){e=oe("circle"),v(e,"r",".1"),v(e,"cx",s[12].x),v(e,"cy",s[12].y)},m(t,n){j(t,e,n)},p:R,d(t){t&&A(e)}}}function Qe(s){let e,t=L(s[9]),n=[];for(let i=0;i<t.length;i+=1)n[i]=Ve(Ke(s,t,i));return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=ke()},m(i,o){for(let r=0;r<n.length;r+=1)n[r]&&n[r].m(i,o);j(i,e,o)},p(i,o){if(o&16){t=L(i[9]);let r;for(r=0;r<t.length;r+=1){const a=Ke(i,t,r);n[r]?n[r].p(a,o):(n[r]=Ve(a),n[r].c(),n[r].m(e.parentNode,e))}for(;r<n.length;r+=1)n[r].d(1);n.length=t.length}},d(i){i&&A(e),rt(n,i)}}}function nn(s){let e,t=[],n=new Map,i,o,r=[],a=new Map,h,c,S,p,C,_=L(s[3]);const d=l=>l[15].id;for(let l=0;l<_.length;l+=1){let f=Ge(s,_,l),g=d(f);n.set(g,t[l]=He(g,f))}let u=L(s[3]);const m=l=>l[15].id;for(let l=0;l<u.length;l+=1){let f=We(s,u,l),g=m(f);a.set(g,r[l]=Je(g,f))}let b=L(s[4].boardPoints),w=[];for(let l=0;l<b.length;l+=1)w[l]=Qe(Be(s,b,l));return{c(){e=ee("div");for(let l=0;l<t.length;l+=1)t[l].c();i=qe(),o=ee("div");for(let l=0;l<r.length;l+=1)r[l].c();h=qe(),c=oe("svg");for(let l=0;l<w.length;l+=1)w[l].c();v(e,"class","preview svelte-2ed58s"),W(e,"--board-size",s[4].boardSize),v(c,"width","100%"),v(c,"height","100%"),v(c,"viewBox",`0 0 ${s[4].boardSize} ${s[4].boardSize}`),v(c,"xmlns","http://www.w3.org/2000/svg"),v(c,"fill","black"),v(c,"class","svelte-2ed58s"),v(o,"class","board svelte-2ed58s"),W(o,"--board-size",s[4].boardSize)},m(l,f){j(l,e,f);for(let g=0;g<t.length;g+=1)t[g]&&t[g].m(e,null);j(l,i,f),j(l,o,f);for(let g=0;g<r.length;g+=1)r[g]&&r[g].m(o,null);Z(o,h),Z(o,c);for(let g=0;g<w.length;g+=1)w[g]&&w[g].m(c,null);S=Ct.observe(o,s[5].bind(o)),C=!0},p(l,[f]){if(f&28&&(_=L(l[3]),we(),t=Ne(t,f,d,1,l,_,n,e,Ue,He,null,Ge),Se()),f&28&&(u=L(l[3]),we(),r=Ne(r,f,m,1,l,u,a,o,Ue,Je,h,We),Se()),f&16){b=L(l[4].boardPoints);let g;for(g=0;g<b.length;g+=1){const P=Be(l,b,g);w[g]?w[g].p(P,f):(w[g]=Qe(P),w[g].c(),w[g].m(c,null))}for(;g<w.length;g+=1)w[g].d(1);w.length=b.length}},i(l){if(!C){for(let f=0;f<_.length;f+=1)q(t[f]);for(let f=0;f<u.length;f+=1)q(r[f]);l&&V(()=>{C&&(p||(p=ce(o,le,{duration:500},!0)),p.run(1))}),C=!0}},o(l){for(let f=0;f<t.length;f+=1)$(t[f]);for(let f=0;f<r.length;f+=1)$(r[f]);l&&(p||(p=ce(o,le,{duration:500},!1)),p.run(0)),C=!1},d(l){l&&(A(e),A(i),A(o));for(let f=0;f<t.length;f+=1)t[f].d();for(let f=0;f<r.length;f+=1)r[f].d();rt(w,l),S(),l&&p&&p.end()}}}function sn(s,e,t){let n,i,o,r=R,a=()=>(r(),r=et(i,d=>t(3,o=d)),i);s.$$.on_destroy.push(()=>r());const h=new tn("https://db.cubiq.dev/");class c{constructor(u,m,b,w){this.id=m,this.pos=b||{x:8,y:8},this.skin=w||"square",this.boardRef=u}setPos(u){this.pos=u,this.boardRef.checkBoardState()}loadSkin(){return Nt[this.skin]}}class S{constructor(u){this.boardSize=u||15,this.boardShapes$=lt([]),this.boardPoints=this.generateBoardSnapPoints(this.boardSize),this.currentLevel=1,this.final=[]}addShape(u,m){this.boardShapes$.update(b=>{const w=new c(this,b.length+1,u,m);return[...b,w]})}setupLevel(u,m){this.currentLevel=m+1,this.boardShapes$.set(u.start.map((b,w)=>new c(this,w,b.pos,b.skin))),this.final=u.final}findCenterFromShapes(u){const m=u.reduce((b,w)=>({x:b.x+w.pos.x,y:b.y+w.pos.y}),{x:0,y:0});return{x:m.x/u.length,y:m.y/u.length}}relativeToCenter(u,m){return{x:u.x-m.x,y:u.y-m.y}}checkBoardState(){this.boardShapes$.update(u=>(this.checkLevelCompletion(u)?console.log("Level completed"):console.log("Level not completed"),u))}arePointsSame(u,m){return u.x===m.x&&u.y===m.y}checkLevelCompletion(u){const m=this.final,b=this.findCenterFromShapes(u),w=this.findCenterFromShapes(m),l=m.map((f,g)=>({skin:f.skin,pos:this.relativeToCenter(f.pos,w)}));return u.every((f,g)=>{const P=this.relativeToCenter(f.pos,b);return l.some((k,T)=>k.skin===f.skin&&this.arePointsSame(P,k.pos)?(l.splice(T,1),!0):!1)})}generateBoardSnapPoints(u){const m=(b,w,l)=>Math.sqrt(b**2+w**2)<=l;return Array(u).fill().map((b,w)=>Array(u).fill().map((l,f)=>({x:w+.5,y:f+.5})).filter((l,f)=>m(l.x/u-.5,l.y/u-.5,.5)))}}let p;const C=new S(15);Oe(async()=>{h.collection("levels").getFirstListItem("levelId=0").then(u=>{C.setupLevel(u,0)}).catch(u=>{console.error(u)})});function _(){var d;p=(d=ne.entries.get(this))==null?void 0:d.borderBoxSize,t(0,p)}return s.$$.update=()=>{s.$$.dirty&1&&t(2,n=p?p[0].blockSize:0)},a(t(1,i=C.boardShapes$)),[p,i,n,o,C,_]}class on extends Ee{constructor(e){super(),Te(this,e,sn,nn,he,{})}}function Ye(s){let e,t;return e=new on({}),{c(){Pe(e.$$.fragment)},m(n,i){ue(e,n,i),t=!0},i(n){t||(q(e.$$.fragment,n),t=!0)},o(n){$(e.$$.fragment,n),t=!1},d(n){de(e,n)}}}function rn(s){let e,t,n=s[0]&&Ye();return{c(){e=ee("main"),n&&n.c(),v(e,"class","svelte-s3li9q")},m(i,o){j(i,e,o),n&&n.m(e,null),t=!0},p(i,[o]){i[0]?n?o&1&&q(n,1):(n=Ye(),n.c(),q(n,1),n.m(e,null)):n&&(we(),$(n,1,1,()=>{n=null}),Se())},i(i){t||(q(n),t=!0)},o(i){$(n),t=!1},d(i){i&&A(e),n&&n.d()}}}function an(s,e,t){let n=!1;return Oe(()=>{setTimeout(()=>{t(0,n=!0)},300)}),[n]}class cn extends Ee{constructor(e){super(),Te(this,e,an,rn,he,{})}}new cn({target:document.getElementById("app")});
